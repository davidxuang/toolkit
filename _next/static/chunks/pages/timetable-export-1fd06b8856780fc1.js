(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[441],{88375:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/timetable-export",function(){return c(87930)}])},87930:function(a,b,c){"use strict";c.r(b),c.d(b,{default:function(){return O}});var d,e,f=c(47568),g=c(828),h=c(29815),i=c(34051),j=c.n(i),k=c(85893),l=c(9669),m=c.n(l),n=c(71011),o=c.n(n),p=c(67294),q=c(47157),r=c(38007),s=c(41119),t=c(85290),u=c(82670),v=c(27596),w=c.n(v),x=c(2165),y=function(a,b){return(0,u.Z)(a,Array)?a.length==b.length&&0==a.filter(function(a,c){return!y(a,b[c])}).length:a===b},z=function(a){var b=!0;return(a.forEach(function(a){a.length>1&&a.slice(1).forEach(function(c){y(a[0],c)||(console.log("---"),console.log(a[0]),console.log(c),b=!1)})}),b)?new Map(Array.from(a.entries()).map(function(a){var b=(0,g.Z)(a,2),c=b[0],d=b[1];return[c,[d[0]],]})):a},A=function(a){var b=arguments.length>1&& void 0!==arguments[1]?arguments[1]:0;return(0,u.Z)(a,Array)?"{ ".concat(a.map(function(a){return A(a,b)}).join(", ")," }"):"nil"==a?(0,x.Z)(b,"nil"):(0,x.Z)(b,"'".concat(a,"'"))},B=function(a,b){return a=z(a),"		{ \n			stations = ".concat(A((0,h.Z)(a.keys())),",\n      data = {\n").concat(Array.from(a).map(function(a){var c=(0,g.Z)(a,2),d=c[0],e=c[1];return"				".concat((0,x.Z)("['".concat(d,"']"),b)," = ").concat(A(e,7),",")}).join("\n"),"\n      }\n		}")},C={CRT:function(a){var b;return Array.from(null===(b=a.querySelector("div.result-line-list"))|| void 0===b?void 0:b.childNodes).filter(function(a){return a.id}).map(function(a){return[a.id.substring(9),a.innerText.trim(),]})}},D=function(a,b){var c=arguments.length>2&& void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3?arguments[3]:void 0;return(0,u.Z)(b,Array)?b.map(function(b){return a[b+c].innerHTML.trim().replace("--",d?"nil":"")}):a[b+c].innerHTML.trim().replace("--",d?"nil":"")},E={CRT:function(a,b){var c=a.querySelector("div.result-line-time-list > table#clay10_"+b),d=(0,g.Z)([0,1,2].map(function(a){return(0,h.Z)(c.tHead.rows[a].querySelectorAll("th.bg-f7f7f7")).filter(function(a){return a.innerHTML.trim().length>2}).map(function(a){return a})}),3),e=d[0],f=d[1],i=d[2];if(0==e.length&&((e=[document.createElement("th")])[0].colSpan=f.map(function(a){return a.colSpan}).reduce(function(a,b){return a+b},0)),console.log(e.length),[1,2].includes(e.length)){if(f.length%e.length!=0||f.length<2)throw f.length;if(i.length%e.length!=0||i.length<2)throw i.length}else throw e.length;for(var j=e[0].colSpan,k=[],l=0;l<e.length;l++)w()(e[l].colSpan==j),k.push(l*j);var m=[[],[],[],[]];if(f.length/e.length==2&&i.length/f.length==2)m=[1,2,3,4];else if(f.length/e.length>=2){var n=0,o=e[0].colSpan,p=!0,q=!1,r=void 0;try{for(var s,t=f[Symbol.iterator]();!(p=(s=t.next()).done);p=!0){var u=s.value,v=u.colSpan;if(u.innerHTML.trim().startsWith("首班车"))for(var x=0;x<v;x++){var y=i[n+x].innerHTML.trim();y.includes("↓")||y.includes("内环")?m[0].push(n+x+1):m[1].push(n+x+1)}else for(var z=0;z<v;z++){var A=i[n+z].innerHTML.trim();A.includes("↓")||A.includes("内环")?m[2].push(n+z+1):m[3].push(n+z+1)}if((n+=v)>=o)break}}catch(B){q=!0,r=B}finally{try{p||null==t.return||t.return()}finally{if(q)throw r}}for(var C=0;C<m.length;C++)m[C]=1==m[C].length?m[C][0]:m[C]}else throw f.length;var E=(0,h.Z)(c.tBodies[0].rows).map(function(a){return(0,h.Z)(a.cells)}),F=new Map,G=!0,H=!1,I=void 0;try{for(var J,K=function(a,b){var c=b.value,d=c[0].innerHTML.trim().replace("航站楼","");if(!d||"--"==d)return"break";F.set(d,k.map(function(a){var b=0==c.slice(1).filter(function(a){return a.innerHTML.trim().length>2}).length;return[[D(c,m[0],a,b),D(c,m[1],a,b),],[D(c,m[2],a,b),D(c,m[3],a,b),],]}))},L=E[Symbol.iterator]();!(G=(J=L.next()).done);G=!0){var M=K(L,J);if("break"===M)break}}catch(N){H=!0,I=N}finally{try{G||null==L.return||L.return()}finally{if(H)throw I}}return F}},F=c(5227),G={foreground:"var(--colorNeutralForeground2)",background:"var(--colorNeutralBackground2)",gray:"var(--colorPaletteAnchorBorderActive)",lightGray:"var(--colorPalettePlatinumBorderActive)",red:"var(--colorPaletteRedBorder2)",lightRed:"var(--colorPaletteRedBorder2)",orange:"var(--colorPalettePumpkinBorderActive)",lightOrange:"var(--colorPalettePumpkinBorderActive)",yellow:"var(--colorPaletteGoldBorderActive)",lightYellow:"var(--colorPaletteGoldBorderActive)",green:"var(--colorPaletteForestBorderActive)",lightGreen:"var(--colorPaletteForestBorderActive)",teal:"var(--colorPaletteSteelBorderActive)",lightTeal:"var(--colorPaletteSteelBorderActive)",blue:"var(--colorPaletteRoyalBlueBorderActive)",lightBlue:"var(--colorPaletteRoyalBlueBorderActive)",purple:"var(--colorPaletteGrapeBorderActive)",lightPurple:"var(--colorPaletteGrapeBorderActive)"},H={'pre[class*="language-"]':{color:G.foreground,fontFamily:"monospace",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",lineHeight:"1.5",MozTabSize:"2",OTabSize:"2",tabSize:"2",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",padding:"1em",margin:".5em 0",overflow:"auto",background:G.background},'code[class*="language-"]':{color:G.foreground,fontFamily:"monospace",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",lineHeight:"1.5",MozTabSize:"2",OTabSize:"2",tabSize:"2",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},':not(pre) > code[class*="language-"]':{padding:".1em",borderRadius:".3em",background:G.background},keyword:{color:G.purple},builtin:{color:G.lightGreen},"class-name":{color:G.lightRed},"maybe-class-name":{color:G.red},function:{color:G.orange},boolean:{color:G.teal},number:{color:G.blue},string:{color:G.lightGreen},char:{color:G.lightBlue},symbol:{color:G.lightBlue},regex:{color:G.lightGreen},url:{color:G.lightPurple},operator:{color:G.purple},variable:{color:G.blue},constant:{color:G.foreground},property:{color:G.gray},"property-access":{color:G.blue},punctuation:{opacity:.75},important:{color:G.gray},comment:{color:G.lightGray},tag:{color:G.blue},"attr-name":{color:G.yellow},"attr-value":{color:G.lightGreen},namespace:{color:G.red},prolog:{color:G.lightGray},doctype:{color:G.lightGray},cdata:{color:G.lightGray},entity:{color:G.purple},atrule:{color:G.purple},selector:{color:G.blue},inserted:{color:G.lightTeal},deleted:{color:G.lightRed}},I=function(a){var b=a.language,c=a.children;return(0,k.jsx)(F.Z,{language:b,style:H,children:c})},J=I,K=c(9008),L=c.n(K),M=(0,q.Z)({main:{marginInline:"auto",paddingBlock:"2rem",maxWidth:"64rem",minHeight:"100vh",backgroundColor:"var(--colorNeutralBackground2)"},actionsBar:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center","> span":{flexGrow:.05},"> div":{flexGrow:.05},"> button":{flexGrow:.05}}});(e=d||(d={}))[e.Initial=0]="Initial",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded";var N=function(){var a,b,c,e=M(),i=(0,p.useState)("CRT"),l=i[0],n=i[1],q=(0,p.useState)(d.Initial),u=q[0],v=q[1],w=(0,p.useState)(),x=w[0],y=w[1],z=(0,p.useState)(),A=z[0],D=z[1],F=(0,p.useState)(""),G=F[0],H=F[1],I=(0,p.useState)(""),K=I[0],N=I[1],O={CRT:function(){return["https://mirror.7355608.best/crt/riding-guide.html"]}},P=(a=(0,f.Z)(j().mark(function a(b){return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n(b.target.value),D([]),y(void 0),v(d.Initial);case 4:case"end":return a.stop()}},a)})),function(b){return a.apply(this,arguments)}),Q=(b=(0,f.Z)(j().mark(function a(){return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:v(d.Loading),Promise.any(O[l]().map(function(a){return m().get(a)})).then(function(a){c=a.headers["content-type"].startsWith("application/json")?new DOMParser().parseFromString(a.data.contents,"text/html"):new DOMParser().parseFromString(a.data,"text/html"),y(c);var b,c,e,f=C[l](c);D(f),H(null!==(e=null==f?void 0:null===(b=f[0])|| void 0===b?void 0:b[0])&& void 0!==e?e:""),v(d.Loaded)});case 2:case"end":return a.stop()}},a)})),function(){return b.apply(this,arguments)}),R=(c=(0,f.Z)(j().mark(function a(){var b,c,d;return j().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:c=E[l](x,G),d=(b=Math).max.apply(b,(0,h.Z)((0,h.Z)(c.keys()).map(function(a){return o()(a)})))+4,N(B(c,d));case 4:case"end":return a.stop()}},a)})),function(){return c.apply(this,arguments)});return(0,k.jsxs)("div",{children:[(0,k.jsx)(L(),{children:(0,k.jsx)("title",{children:"Wikipedia时刻表导出"})}),(0,k.jsxs)("main",{className:e.main,children:[(0,k.jsxs)("div",{className:e.actionsBar,children:[(0,k.jsx)(t.P,{onChange:P,children:(0,k.jsx)("option",{value:"CRT",children:"重庆轨道交通"})}),(0,k.jsx)("div",{}),(0,k.jsx)(r.z,{onClick:Q,children:u==d.Loading?(0,k.jsx)(s.$,{size:"tiny"}):"下载"}),(0,k.jsx)("div",{}),(0,k.jsx)(t.P,{onChange:function(a){return H(a.target.value)},children:null==A?void 0:A.map(function(a){var b=(0,g.Z)(a,2),c=b[0],d=b[1];return(0,k.jsx)("option",{value:c,children:d},c)})}),(0,k.jsx)("div",{}),(0,k.jsx)(r.z,{onClick:R,disabled:u!=d.Loaded,children:"导出"})]}),(0,k.jsx)(J,{language:"lua",children:K})]})]})},O=N}},function(a){a.O(0,[945,551,277,774,888,179],function(){var b;return a(a.s=88375)}),_N_E=a.O()}])